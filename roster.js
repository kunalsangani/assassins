var players = [
	{
		last_name: 'Alonzo-Estrada',
		first_name: 'Jaysha',
		email: 'jayshaa@stanford.edu',
		phone: '+18083332613',
		alive: true
	},
	{
		last_name: 'Blake',
		first_name: 'Ray',
		email: 'rayblake@stanford.edu',
		phone: '+14084764526',
		alive: false
	},
	{
		last_name: 'Blake',
		first_name: 'Shoney',
		email: 'shoneyblake@stanford.edu',
		phone: '+14052099206',
		alive: false
	},
	{
		last_name: 'Bovee',
		first_name: 'Griffin',
		email: 'gbovee@stanford.edu',
		phone: '+19162248577',
		alive: false
	},
	{
		last_name: 'Broad',
		first_name: 'Nicholas',
		email: 'nbroad@stanford.edu',
		phone: '+14085020208',
		alive: false
	},
	{
		last_name: 'Buenaflor',
		first_name: 'John Carlo',
		email: 'jcbuena@stanford.edu',
		phone: '+12138189173029',
		alive: false
	},
	{
		last_name: 'Chen',
		first_name: 'Hannah',
		email: 'hkchen5@stanford.edu',
		phone: '+15108251627',
		alive: false
	},
	{
		last_name: 'Chen',
		first_name: 'Ray',
		email: 'juikang@stanford.edu',
		phone: '+14088960990',
		alive: false
	},
	{
		last_name: 'Clark',
		first_name: 'Josiah',
		email: 'josiahc@stanford.edu',
		phone: '+18088964250',
		alive: false
	},
	{
		last_name: 'Coleman',
		first_name: 'Emma',
		email: 'ecolema2@stanford.edu',
		phone: '+17736201702',
		alive: false
	},
	{
		last_name: 'DeCastro',
		first_name: 'Allison',
		email: 'agd16@stanford.edu',
		phone: '+1425444-2624',
		alive: false
	},
	{
		last_name: 'Eggers',
		first_name: 'Jessica',
		email: 'jeggers3@stanford.edu',
		phone: '+14066000797',
		alive: true
	},
	{
		last_name: 'Garcia',
		first_name: 'Rebekah',
		email: 'ragarcia@stanford.edu',
		phone: '+15625065277',
		alive: false
	},
	{
		last_name: 'Gladstone',
		first_name: 'Lauve',
		email: 'laglad@stanford.edu',
		phone: '+17035776582',
		alive: false
	},
	{
		last_name: 'Godbole',
		first_name: 'Poorwa',
		email: 'pgodbole@stanford.edu',
		phone: '+17245185699',
		alive: true
	},
	{
		last_name: 'Grant',
		first_name: 'Eva',
		email: 'evagrant@stanford.edu',
		phone: '+12508184811',
		alive: false
	},
	{
		last_name: 'Hatathlie',
		first_name: 'Kenaba',
		email: 'kenaba@stanford.edu',
		phone: '+15052155808',
		alive: false
	},
	{
		last_name: 'Hattori',
		first_name: 'Matthew',
		email: 'mhattori@stanford.edu',
		phone: '+14084064282',
		alive: false
	},
	{
		last_name: 'Karrfelt',
		first_name: 'Filippa',
		email: 'filippak@stanford.edu',
		phone: '+16509337247',
		alive: false
	},
	{
		last_name: 'Kehoe',
		first_name: 'Emmie',
		email: 'emkehoe@stanford.edu',
		phone: '+12069141681',
		alive: true
	},
	{
		last_name: 'Lee',
		first_name: 'Andrew',
		email: 'alee16@stanford.edu',
		phone: '+13154163102',
		alive: false
	},
	{
		last_name: 'Leonard',
		first_name: 'Shane',
		email: 'shanel@stanford.edu',
		phone: '+17192012530',
		alive: true
	},
	{
		last_name: 'Lucio',
		first_name: 'Scott',
		email: 'slucio@stanford.edu',
		phone: '+15307613324',
		alive: false
	},
	{
		last_name: 'McKown',
		first_name: 'Katelyn',
		email: 'kmckown@stanford.edu',
		phone: '+16268082615',
		alive: true
	},
	{
		last_name: 'Militante',
		first_name: 'Jessie',
		email: 'jmilitan@stanford.edu',
		phone: '+14088216343',
		alive: false
	},
	{
		last_name: 'Robinson',
		first_name: 'Sarah',
		email: 'srobins2@stanford.edu',
		phone: '+16508158840',
		alive: false
	},
	{
		last_name: 'Rodriguez',
		first_name: 'Irving',
		email: 'irod973@stanford.edu',
		phone: '+17085594040',
		alive: true
	},
	{
		last_name: 'Ruiz',
		first_name: 'John',
		email: 'johnruiz@stanford.edu',
		phone: '+19738519125',
		alive: true
	},
	{
		last_name: 'Salonga',
		first_name: 'Edward',
		email: 'esalonga@stanford.edu',
		phone: '+16504683772',
		alive: false
	},
	{
		last_name: 'Sangani',
		first_name: 'Kunal',
		email: 'ksangani@stanford.edu',
		phone: '+13153825338',
		alive: false
	},
	{
		last_name: 'Smith',
		first_name: 'Carson',
		email: 'csmith97@stanford.edu',
		phone: '+17082184704',
		alive: false
	},
	{
		last_name: 'Tobacco',
		first_name: 'Jan',
		email: 'january@stanford.edu',
		phone: '+16058992513',
		alive: false
	},
	{
		last_name: 'Troderman',
		first_name: 'Joe',
		email: 'jtrod93@stanford.edu',
		phone: '+17816368261',
		alive: false
	},
	{
		last_name: 'Wedekind',
		first_name: 'Lauren',
		email: 'laurene1@stanford.edu',
		phone: '+13108096155',
		alive: false
	},
	{
		last_name: 'Whitfield',
		first_name: 'Emery',
		email: 'emerynez@stanford.edu',
		phone: '+15055040084',
		alive: false
	},
	{
		last_name: 'Wright',
		first_name: 'Lena',
		email: 'tseabbe2@stanford.edu',
		phone: '+17757414042',
		alive: false
	}
];

// var MongoClient = require('mongodb').MongoClient;
// var assert = require('assert');
// var ObjectId = require('mongodb').ObjectID;
// var url = 'mongodb://localhost:27017/players';

// var insertPlayers = function(db, callback) {
// 	db.collection('players').insertOne(players, function(err, result) {
// 		assert.equal(err, null);
// 		console.log('Players inserted into collection.');
// 		callback(result);
// 	});
// }

// var retrievePlayers = function(db, callback) {
// 	var cursor = db.collection('players').find();
// 	console.log(cursor);
// 	console.log(cursor.next());
// 	cursor.each(function(err, doc) {
// 		console.log('--X--')
// 		console.log(doc);
// 		console.log('----')
// 	})
// 	var players_doc = cursor.hasNext() ? cursor.next() : null;
// 	if(players_doc == null) {
// 		insertPlayers(db, callback);
// 	} else {
// 		callback(players_doc);
// 	}
// }

var assignPlayersInitialTargets = function() {
	var targets = [17, 30, 3, 25, 8, 18, 24, 0, 32, 15, 9, 33, 7, 14, 31, 26, 2, 19, 21, 6, 35, 16, 29, 5, 22, 10, 1, 34, 13, 23, 4, 11, 20, 12, 27, 28];
	targets = [19, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, 11, -1, -1, -1, -1, 27, -1, 26, -1, 21, -1, -1, 14, 23, -1, -1, -1, -1, -1, -1, -1, -1];
	
	for(var i = 0; i < players.length; i++) {
		players[i].target = targets[i];
	} 
}();

var lookupPlayerByPhone = function(phone_str){
	for(var i = 0; i < players.length; i++) {
		if(players[i].phone == phone_str)
			return players[i];
	}
	return undefined;
}

var lookupPlayerByIndex = function(player_ind){
	if(player_ind < 0) return undefined;
	return players[player_ind];
}

var killPlayer = function(player_ind){
    if(player_ind == undefined) return -1;
    if(player_ind < 0 || player_ind >= players.length) return -1;
    players[player_ind].alive = false;
    for(var i = 0; i < players.length; i++) {
	if(players[i].target == player_ind)
	    players[i].target = players[player_ind].target;
    }
    players[player_ind].target = -1;
    if(numPlayersLeft() == 1) return 1;
    return 0;
}

var numPlayersLeft = function(){
	playersLeft = 0;
	for(var i = 0; i < players.length; i++) {
		if(players[i].alive) playersLeft++;
	}
	return playersLeft;
}

    var changePhoneNumber = function(player_ind, new_phone){
	if(player_ind == undefined) return -1;
	if(player_ind < 0 || player_ind >= players.length) return -1;
	players[player_ind].phone = new_phone;
    }

module.exports = {
	lookupPlayerByPhone : lookupPlayerByPhone,
	lookupPlayerByIndex : lookupPlayerByIndex,
	killPlayer : killPlayer,
	numPlayersLeft : numPlayersLeft,
	changePhoneNumber : changePhoneNumber,
	players : players
};

// MongoClient.connect(url, function(err, db) {
// 	assert.equal(null, err);
// 	console.log('Connected correctly to server.');
// 	retrievePlayers(db, function(res){
// 		console.log(res);
// 	});
// 	db.close();
// });